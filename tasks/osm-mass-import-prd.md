# PRD: OpenStreetMap Mass Import Integration

## Overview

Add mass-import functionality for OpenStreetMap public artwork data generated by `src\data-collection\osm\fetch-osm-artworks.js`. This will enable bulk importing of OSM artwork data with proper attribution, tagging, and integration into the existing Cultural Archiver platform.

## Data Source Analysis

**Input Format**: GeoJSON FeatureCollection from `src\data-collection\osm\output\merged\merged-artworks.geojson`

**Sample Data Structure**:
```json
{
  "type": "Feature",
  "id": "node/4343692187",
  "properties": {
    "osm_type": "node",
    "osm_id": 4343692187,
    "artist_name": "Brent Sparrow Jr.",
    "artwork_type": "carving",
    "material": "wood",
    "name": "Musqueam Post",
    "tourism": "artwork",
    "website": "https://example.com"
  },
  "geometry": {
    "type": "Point",
    "coordinates": [-123.2511237, 49.2653777]
  }
}
```

## Implementation Questions

### 1. Import Processing Strategy

**A.** Use existing sequential mass-import system with batch processing (500 records/batch)  
**B.** Create dedicated OSM importer with optimized GeoJSON parsing  
**C.** Hybrid approach: GeoJSON parser feeding into existing mass-import pipeline  
**D.** Stream processing for very large datasets (>10k artworks)

**Recommended: C** - Provides best balance of reusability and optimization

### 2. Data Validation & Quality

**A.** Import all OSM records as-is, mark as "pending" for review  
**B.** Apply strict validation filters (require name + coordinates, skip incomplete)  
**C.** Tiered validation: core data auto-approved, extended data pending  
**D.** Manual review queue for all OSM imports regardless of completeness

**Recommended: B** - Ensures data quality while maximizing useful imports

### 3. Duplicate Detection Strategy

**A.** Use existing 50m radius duplicate detection with OSM external_id matching  
**B.** Enhanced detection: 100m radius + fuzzy name matching + external_id check  
**C.** OSM-specific detection: exact coordinate matching (OSM precision) + external_id  
**D.** Disable duplicate detection for OSM imports (assume OSM data is canonical)

**Recommended: B** - Accounts for potential coordinate variations between sources

### 4. Tag Structure Mapping

**A.** Map all OSM properties as individual tags (artist_name → "Artist Name" tag)  
**B.** Preserve raw OSM data in single "osm_data" tag + extract key fields  
**C.** Smart mapping: common fields to platform fields, others as tags  
**D.** Minimal mapping: only extract name, artist, coordinates

**Recommended: C** - Balances searchability with data preservation

### 5. Attribution & Licensing

**A.** Add attribution in description field: "Data from OpenStreetMap © contributors"  
**B.** Structured attribution tags: Source, License, Attribution as separate tags  
**C.** Combined approach: description text + structured tags  
**D.** Minimal attribution: only "Source: OpenStreetMap" tag

**Recommended: B** - Provides machine-readable attribution for future use

### 6. Photo Handling

**A.** Skip photos for OSM imports (OSM rarely has direct photo links)  
**B.** Attempt to download from website URLs if present  
**C.** Leave photo fields empty, allow manual addition later  
**D.** Generate placeholder images with artwork information

**Recommended: A** - OSM data typically doesn't include photos

### 7. User Assignment & Permissions

**A.** Create dedicated "osm-importer" system user for all imports  
**B.** Assign to admin user running the import  
**C.** Create anonymous imports with special "OSM" attribution  
**D.** Allow specification of importing user in command parameters

**Recommended: A** - Maintains clear audit trail and attribution

### 8. Error Handling & Recovery

**A.** Fail fast: stop import on first validation error  
**B.** Skip invalid records, log errors, continue processing  
**C.** Retry failed records up to 3 times with exponential backoff  
**D.** Two-pass system: validate all first, then import valid records

**Recommended: B** - Maximizes successful imports while maintaining error visibility

### 9. Progress Tracking & Monitoring

**A.** Command-line progress bar with summary statistics  
**B.** Detailed logging to file with per-record status  
**C.** Database tracking table for import batches and status  
**D.** Real-time dashboard for monitoring large imports

**Recommended: B** - Provides detailed audit trail for troubleshooting

### 10. Configuration & Customization

**A.** Hard-coded OSM mapping configuration  
**B.** JSON configuration file for field mappings and rules  
**C.** Command-line parameters for common options  
**D.** Web-based configuration interface for administrators

**Recommended: B** - Allows customization for different OSM datasets/regions

## Technical Specification

### Field Mappings
- `properties.name` → `title`
- `properties.artist_name` → `created_by` 
- `geometry.coordinates[0]` → `lon`
- `geometry.coordinates[1]` → `lat`
- `id` → `external_id` tag
- All other properties → individual tags

### Required Tags
- Source: "OpenStreetMap"
- License: "[ODbL](https://www.openstreetmap.org/copyright)"
- Attribution: "© OpenStreetMap contributors"
- External ID: OSM feature ID (e.g., "node/4343692187")

### API Endpoints
- `POST /api/mass-import/osm` - Trigger OSM import from file path
- `GET /api/mass-import/osm/status/{batch_id}` - Check import progress
- `GET /api/mass-import/osm/history` - List previous OSM import batches

## Success Criteria
- Successfully import >95% of valid OSM records
- Proper duplicate detection prevents data duplication
- All imports properly attributed to OpenStreetMap
- Import process completes Vancouver dataset (~2000 records) in <5 minutes
- Comprehensive error logging for failed records
- Integration with existing mass-import infrastructure

## Next Steps
Please answer the numbered questions above to finalize the implementation approach. Each question includes a recommended option based on the existing codebase analysis.